<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freedom Cabins NZ - Cabin Configurator</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f8f9fa;
            color: #474d60;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Section */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: white;
            border-radius: 15px;
            margin-bottom: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .header h1 {
            color: #da8a67;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            color: #666;
            font-size: 1.2rem;
        }

        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* Cabin Gallery Section */
        .cabin-gallery {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .cabin-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .cabin-image {
            width: 100%;
            max-width: 600px;
            height: 400px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #999;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .cabin-info {
            margin-top: 20px;
        }

        .cabin-info h3 {
            color: #474d60;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .cabin-info p {
            color: #666;
            font-size: 1.1rem;
        }

        /* Configuration Form */
        .config-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .config-section h2 {
            color: #474d60;
            font-size: 1.5rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #474d60;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            color: #474d60;
            background-color: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .form-group select:hover {
            border-color: #da8a67;
        }

        .form-group select:focus {
            outline: none;
            border-color: #da8a67;
            box-shadow: 0 0 0 3px rgba(218, 138, 103, 0.1);
        }

        /* Summary Section */
        .summary-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .summary-section h2 {
            color: #474d60;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .price-display {
            background: linear-gradient(135deg, #da8a67, #c77755);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .price-display .label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .price-display .amount {
            font-size: 2rem;
            font-weight: 700;
        }

        .price-breakdown {
            margin-bottom: 20px;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            color: #666;
        }

        .price-item:last-child {
            border-bottom: none;
            font-weight: 600;
            color: #474d60;
            font-size: 1.1rem;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }

        /* Buttons */
        .btn {
            background: #da8a67;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            background: #c77755;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(218, 138, 103, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Modal Styles - FIXED STYLING */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 550px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.25);
            position: relative;
            border: 1px solid #e0e0e0;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h2 {
            color: #474d60;
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .modal-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f5f5f5;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #e0e0e0;
            transform: rotate(90deg);
        }

        .form-row {
            margin-bottom: 25px;
        }

        .form-row label {
            display: block;
            color: #474d60;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-row input,
        .form-row textarea {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            color: #474d60;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .form-row input:focus,
        .form-row textarea:focus {
            outline: none;
            border-color: #da8a67;
            box-shadow: 0 0 0 3px rgba(218, 138, 103, 0.1);
        }

        .form-row textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .email-backup-text {
            margin-top: 20px;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .email-backup-text a {
            color: #da8a67;
            text-decoration: none;
            font-weight: 600;
        }

        .email-backup-text a:hover {
            text-decoration: underline;
        }

        /* Success/Error Messages - IMPROVED */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #28a745;
            font-weight: 500;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #dc3545;
            font-weight: 500;
        }

        .info-message {
            background: #e3f2fd;
            color: #1565c0;
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #2196f3;
            font-weight: 500;
        }

        /* Debug Panel */
        .debug-panel {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.85rem;
            display: none;
        }

        .debug-panel h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .debug-panel pre {
            background: white;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 0.8rem;
        }

        /* Cabin Examples Grid */
        .cabin-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .cabin-example {
            background: #f8f8f8;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .cabin-example:hover {
            border-color: #da8a67;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .cabin-example.active {
            border-color: #da8a67;
            background: #fff5f0;
        }

        .cabin-example img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
            background: #e0e0e0;
        }

        .cabin-example h4 {
            color: #474d60;
            font-size: 0.95rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .cabin-example p {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .summary-section {
                position: static;
                margin-top: 30px;
            }

            .cabin-gallery {
                order: -1;
            }
        }

        @media (max-width: 640px) {
            .header h1 {
                font-size: 2rem;
            }

            .cabin-image {
                height: 250px;
            }

            .cabin-examples {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }

            .modal-content {
                padding: 25px;
                margin: 10px;
            }

            .modal-header h2 {
                font-size: 1.6rem;
            }
        }

        /* Success Animation */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Freedom Cabins NZ</h1>
            <p>Design Your Perfect Cabin</p>
        </div>

        <div class="main-content">
            <div class="cabin-gallery">
                <div class="cabin-display">
                    <div class="cabin-image" id="mainCabinImage">
                        Select a cabin to see preview
                    </div>
                    <div class="cabin-info">
                        <h3 id="cabinDisplayName">Choose Your Cabin Model</h3>
                        <p id="cabinDisplayInfo">Browse our range of quality cabins below</p>
                    </div>
                </div>

                <div class="config-section">
                    <h2>Configuration Options</h2>

                    <div class="form-group">
                        <label for="buildCategory">Build Category</label>
                        <select id="buildCategory">
                            <option value="basic">Basic Build (+$0)</option>
                            <option value="standard">Standard Build (+$15,000)</option>
                            <option value="superior">Superior Build (+$25,000)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="cabinModel">Cabin Model</label>
                        <select id="cabinModel">
                            <option value="">-- Select a Model --</option>
                        </select>
                    </div>

                    <div class="cabin-examples" id="cabinExamples">
                        <!-- Cabin examples will be populated here -->
                    </div>

                    <h3 style="color: #474d60; font-size: 1.3rem; margin-top: 30px; margin-bottom: 20px; padding-top: 20px; border-top: 2px solid #f0f0f0;">Upgrade Options</h3>

                    <div class="form-group">
                        <label for="bathroomPackage">Bathroom Package</label>
                        <select id="bathroomPackage">
                            <option value="standard">Standard Bathroom</option>
                            <option value="deluxe">Deluxe Bathroom (+$3,500)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="kitchenPackage">Kitchen Package</label>
                        <select id="kitchenPackage">
                            <option value="standard">Standard Kitchen</option>
                            <option value="deluxe">Deluxe Kitchen (+$4,200)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="cedarPanels">Cedar Panel Cladding</label>
                        <select id="cedarPanels">
                            <option value="none">No Cedar Panels</option>
                            <option value="partial">Partial Cedar Panels (+$3,800)</option>
                            <option value="full">Full Cedar Cladding (+$7,500)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="cupboards">Storage Cupboards</label>
                        <select id="cupboards">
                            <option value="standard">Standard Cupboards</option>
                            <option value="premium">Premium Cupboards (+$2,800)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="doorUpgrades">Interior Door Upgrades</label>
                        <select id="doorUpgrades">
                            <option value="none">No Door Upgrades</option>
                            <option value="1-barn">1 Barn Door (+$800)</option>
                            <option value="2-barn">2 Barn Doors (+$1,600)</option>
                            <option value="3-barn">3 Barn Doors (+$2,400)</option>
                            <option value="1-cavity">1 Cavity Slider (+$600)</option>
                            <option value="2-cavity">2 Cavity Sliders (+$1,200)</option>
                            <option value="3-cavity">3 Cavity Sliders (+$1,800)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="deliveryLocation">Delivery Location</label>
                        <select id="deliveryLocation">
                            <option value="tauranga">Tauranga (Free)</option>
                            <option value="bop">Bay of Plenty (+$500)</option>
                            <option value="waikato">Waikato (+$800)</option>
                            <option value="auckland">Auckland (+$1,200)</option>
                            <option value="wellington">Wellington (+$2,000)</option>
                            <option value="christchurch">Christchurch (+$2,500)</option>
                            <option value="other">Other Location (+$1,500)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="summary-section">
                <h2>Your Quote</h2>
                
                <div class="price-display">
                    <div class="label">Total Price</div>
                    <div class="amount" id="totalPrice">$0</div>
                </div>

                <div class="price-breakdown" id="priceBreakdown">
                    <div class="price-item">
                        <span>Base Price</span>
                        <span>$0</span>
                    </div>
                </div>

                <button class="btn" onclick="requestQuote()">Get Your Quote</button>
            </div>
        </div>
    </div>

    <!-- Quote Modal - IMPROVED STYLING -->
    <div class="modal" id="quoteModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            
            <div class="modal-header">
                <h2>Request Your Quote</h2>
                <p>We'll send you a detailed quote within 1 hour</p>
            </div>

            <!-- Status Messages -->
            <div id="statusMessage"></div>

            <form id="quoteForm">
                <div class="form-row">
                    <label for="customerName">Your Name *</label>
                    <input type="text" id="customerName" name="customerName" required placeholder="Enter your full name">
                </div>

                <div class="form-row">
                    <label for="customerEmail">Email Address *</label>
                    <input type="email" id="customerEmail" name="customerEmail" required placeholder="your.email@example.com">
                </div>

                <div class="form-row">
                    <label for="customerPhone">Phone Number *</label>
                    <input type="tel" id="customerPhone" name="customerPhone" required placeholder="021 123 4567">
                </div>

                <div class="form-row">
                    <label for="customerAddress">Delivery Address</label>
                    <input type="text" id="customerAddress" name="customerAddress" placeholder="123 Main Street, City">
                </div>

                <div class="form-row">
                    <label for="additionalNotes">Additional Notes</label>
                    <textarea id="additionalNotes" name="additionalNotes" 
                              placeholder="Any special requirements or questions?"></textarea>
                </div>

                <button type="submit" class="btn">Send Quote Request</button>
                
                <div class="email-backup-text">
                    <strong>Having issues?</strong><br>
                    <a href="#" onclick="openEmailBackup(); return false;">📧 Email directly</a> or 
                    <a href="#" onclick="showQuoteText(); return false;">📋 Copy quote details</a>
                </div>

                <!-- Debug Panel -->
                <div class="debug-panel" id="debugPanel">
                    <h4>🔧 Debug Information</h4>
                    <pre id="debugInfo">Waiting for submission...</pre>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 🎯 WIX BACKEND API - TEST MULTIPLE ENDPOINTS
        const WIX_API_ENDPOINTS = [
            'https://freedomcabinsnz.wixsite.com/my-site-2/_functions/submitCabinQuote',
            'https://freedomcabinsnz.wixsite.com/_functions/submitCabinQuote'
        ];
        
        // Cabin models data with pricing
        const cabinModels = {
            '8.4x3-1bed': { 
                name: '8.4x3 - 1 Bedroom', 
                size: '25.2m²', 
                price: 67900, 
                hasBathroom: true, 
                hasKitchen: true,
                image: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><rect fill="%23f8f8f8" width="400" height="300"/><text x="50%" y="45%" text-anchor="middle" fill="%23da8a67" font-size="28" font-weight="600">8.4m x 3m</text><text x="50%" y="60%" text-anchor="middle" fill="%23666" font-size="20">1 Bedroom Cabin</text></svg>',
                description: 'Compact 1 bedroom cabin perfect for individuals or couples'
            },
            '10x3-1bed': { 
                name: '10x3 - 1 Bedroom', 
                size: '30m²', 
                price: 81900, 
                hasBathroom: true, 
                hasKitchen: true,
                image: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><rect fill="%23f8f8f8" width="400" height="300"/><text x="50%" y="45%" text-anchor="middle" fill="%23da8a67" font-size="28" font-weight="600">10m x 3m</text><text x="50%" y="60%" text-anchor="middle" fill="%23666" font-size="20">1 Bedroom Cabin</text></svg>',
                description: 'Spacious 1 bedroom layout with additional living space'
            },
            '10x3-1bed-ensuite': { 
                name: '10x3 - 1 Bedroom + Ensuite', 
                size: '30m²', 
                price: 82900, 
                hasBathroom: true, 
                hasKitchen: true,
                image: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><rect fill="%23f8f8f8" width="400" height="300"/><text x="50%" y="45%" text-anchor="middle" fill="%23da8a67" font-size="28" font-weight="600">10m x 3m</text><text x="50%" y="60%" text-anchor="middle" fill="%23666" font-size="20">1 Bed + Ensuite</text></svg>',
                description: '1 bedroom with private ensuite bathroom for added convenience'
            },
            '10x3-2bed': { 
                name: '10x3 - 2 Bedroom', 
                size: '30m²', 
                price: 86900, 
                hasBathroom: true, 
                hasKitchen: true,
                image: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><rect fill="%23f8f8f8" width="400" height="300"/><text x="50%" y="45%" text-anchor="middle" fill="%23da8a67" font-size="28" font-weight="600">10m x 3m</text><text x="50%" y="60%" text-anchor="middle" fill="%23666" font-size="20">2 Bedroom Cabin</text></svg>',
                description: 'Efficient 2 bedroom design ideal for small families'
            },
            '10.8x3-1bed': { 
                name: '10.8x3 - 1 Bedroom', 
                size: '32.4m²', 
                price: 97900, 
                hasBathroom: true, 
                hasKitchen: true,
                image: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><rect fill="%23f8f8f8" width="400" height="300"/><text x="50%" y="45%" text-anchor="middle" fill="%23da8a67" font-size="28" font-weight="600">10.8m x 3m</text><text x="50%" y="60%" text-anchor="middle" fill="%23666" font-size="20">1 Bedroom Cabin</text></svg>',
                description: 'Premium 1 bedroom cabin with maximum living space'
            },
            '10.8x3-2bed': { 
                name: '10.8x3 - 2 Bedroom', 
                size: '32.4m²', 
                price: 98900, 
                hasBathroom: true, 
                hasKitchen: true,
                image: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><rect fill="%23f8f8f8" width="400" height="300"/><text x="50%" y="45%" text-anchor="middle" fill="%23da8a67" font-size="28" font-weight="600">10.8m x 3m</text><text x="50%" y="60%" text-anchor="middle" fill="%23666" font-size="20">2 Bedroom Cabin</text></svg>',
                description: 'Comfortable 2 bedroom layout with ample space'
            },
            '12x4-2bed': { 
                name: '12x4 - 2 Bedroom', 
                size: '48m²', 
                price: 125900, 
                hasBathroom: true, 
                hasKitchen: true,
                image: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><rect fill="%23f8f8f8" width="400" height="300"/><text x="50%" y="45%" text-anchor="middle" fill="%23da8a67" font-size="28" font-weight="600">12m x 4m</text><text x="50%" y="60%" text-anchor="middle" fill="%23666" font-size="20">2 Bedroom Cabin</text></svg>',
                description: 'Spacious family cabin with generous living areas'
            }
        };

        // Build category upgrades
        const buildUpgrades = {
            'basic': 0,
            'standard': 15000,
            'superior': 25000
        };

        // Current configuration
        let currentConfig = {
            buildCategory: 'basic',
            model: '',
            bathroom: 'standard',
            kitchen: 'standard',
            cedarPanels: 'none',
            cupboards: 'standard',
            doors: 'none',
            delivery: 'tauranga'
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🏠 Freedom Cabins Configurator Loading...');
            console.log('📍 Current URL:', window.location.href);
            
            loadCabinModels();
            createCabinExamples();
            setupEventListeners();
            updateDisplay();
            
            // Test Wix backend connection on load
            testBackendConnection();
            
            console.log('✅ Configurator Ready!');
        });

        // Test backend connection
        async function testBackendConnection() {
            console.log('🔍 Testing Wix backend connection...');
            
            for (const endpoint of WIX_API_ENDPOINTS) {
                try {
                    const healthUrl = endpoint.replace('submitCabinQuote', 'health');
                    console.log('Testing health endpoint:', healthUrl);
                    
                    const response = await fetch(healthUrl);
                    if (response.ok) {
                        const data = await response.json();
                        console.log('✅ Backend connection successful:', data);
                        return endpoint; // Return working endpoint
                    }
                } catch (error) {
                    console.log('❌ Endpoint failed:', endpoint, error.message);
                }
            }
            
            console.warn('⚠️ No working backend endpoints found');
            return null;
        }

        // Show status message with improved styling
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = type === 'error' ? 'error-message' : 
                                 type === 'success' ? 'success-message' : 'info-message';
            statusDiv.innerHTML = message;
            statusDiv.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Show debug information
        function showDebugInfo(info) {
            const debugPanel = document.getElementById('debugPanel');
            const debugInfo = document.getElementById('debugInfo');
            
            debugInfo.textContent = JSON.stringify(info, null, 2);
            debugPanel.style.display = 'block';
        }

        // Create cabin example cards
        function createCabinExamples() {
            const container = document.getElementById('cabinExamples');
            container.innerHTML = '';
            
            Object.entries(cabinModels).forEach(([key, model]) => {
                const div = document.createElement('div');
                div.className = 'cabin-example';
                div.dataset.model = key;
                div.innerHTML = `
                    <img src="${model.image}" alt="${model.name}">
                    <h4>${model.name}</h4>
                    <p>${model.size} • $${model.price.toLocaleString()}</p>
                `;
                div.addEventListener('click', function() {
                    selectCabin(key);
                });
                container.appendChild(div);
            });
        }

        // Select cabin function
        function selectCabin(modelKey) {
            document.getElementById('cabinModel').value = modelKey;
            currentConfig.model = modelKey;
            updateDisplay();
            
            document.querySelectorAll('.cabin-example').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelector(`[data-model="${modelKey}"]`)?.classList.add('active');
        }

        // Load cabin models
        function loadCabinModels() {
            const select = document.getElementById('cabinModel');
            const buildCategory = currentConfig.buildCategory;
            
            select.innerHTML = '<option value="">-- Select a Model --</option>';
            
            Object.entries(cabinModels).forEach(([key, model]) => {
                const option = document.createElement('option');
                option.value = key;
                const basePrice = model.price + buildUpgrades[buildCategory];
                option.textContent = model.name + ' - ' + model.size + ' ($' + basePrice.toLocaleString() + ')';
                
                if (key === currentConfig.model) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('buildCategory').addEventListener('change', function() {
                currentConfig.buildCategory = this.value;
                loadCabinModels();
                updateDisplay();
            });

            document.getElementById('cabinModel').addEventListener('change', function() {
                currentConfig.model = this.value;
                updateDisplay();
                
                document.querySelectorAll('.cabin-example').forEach(el => {
                    el.classList.remove('active');
                });
                if (this.value) {
                    document.querySelector(`[data-model="${this.value}"]`)?.classList.add('active');
                }
            });

            document.getElementById('bathroomPackage').addEventListener('change', function() {
                currentConfig.bathroom = this.value;
                updateDisplay();
            });

            document.getElementById('kitchenPackage').addEventListener('change', function() {
                currentConfig.kitchen = this.value;
                updateDisplay();
            });

            document.getElementById('cedarPanels').addEventListener('change', function() {
                currentConfig.cedarPanels = this.value;
                updateDisplay();
            });

            document.getElementById('cupboards').addEventListener('change', function() {
                currentConfig.cupboards = this.value;
                updateDisplay();
            });

            document.getElementById('doorUpgrades').addEventListener('change', function() {
                currentConfig.doors = this.value;
                updateDisplay();
            });

            document.getElementById('deliveryLocation').addEventListener('change', function() {
                currentConfig.delivery = this.value;
                updateDisplay();
            });
        }

        // Update display with price calculations
        function updateDisplay() {
            const mainImage = document.getElementById('mainCabinImage');
            const displayName = document.getElementById('cabinDisplayName');
            const displayInfo = document.getElementById('cabinDisplayInfo');
            
            if (!currentConfig.model) {
                mainImage.style.backgroundImage = '';
                mainImage.textContent = 'Select a cabin to see preview';
                displayName.textContent = 'Choose Your Cabin Model';
                displayInfo.textContent = 'Browse our range of quality cabins below';
                document.getElementById('totalPrice').textContent = '$0';
                
                document.getElementById('priceBreakdown').innerHTML = `
                    <div class="price-item">
                        <span>Base Price</span>
                        <span>$0</span>
                    </div>
                `;
                return;
            }

            const model = cabinModels[currentConfig.model];
            const buildUpgrade = buildUpgrades[currentConfig.buildCategory];
            
            mainImage.style.backgroundImage = `url('${model.image}')`;
            mainImage.textContent = '';
            displayName.textContent = model.name;
            displayInfo.textContent = `${model.size} • ${model.description}`;
            
            let total = model.price + buildUpgrade;
            let breakdown = [];
            
            const buildCategoryName = document.getElementById('buildCategory').options[document.getElementById('buildCategory').selectedIndex].text;
            breakdown.push({
                name: model.name + ' - ' + buildCategoryName,
                price: model.price + buildUpgrade
            });
            
            if (currentConfig.bathroom === 'deluxe' && model.hasBathroom) {
                total += 3500;
                breakdown.push({ name: 'Deluxe Bathroom Package', price: 3500 });
            }
            
            if (currentConfig.kitchen === 'deluxe' && model.hasKitchen) {
                total += 4200;
                breakdown.push({ name: 'Deluxe Kitchen Package', price: 4200 });
            }
            
            if (currentConfig.cedarPanels !== 'none') {
                let cedarPrice = 0;
                let cedarName = '';
                
                switch(currentConfig.cedarPanels) {
                    case 'partial': cedarPrice = 3800; cedarName = 'Partial Cedar Panels'; break;
                    case 'full': cedarPrice = 7500; cedarName = 'Full Cedar Cladding'; break;
                }
                
                if (cedarPrice > 0) {
                    total += cedarPrice;
                    breakdown.push({ name: cedarName, price: cedarPrice });
                }
            }
            
            if (currentConfig.cupboards === 'premium') {
                total += 2800;
                breakdown.push({ name: 'Premium Cupboards', price: 2800 });
            }
            
            if (currentConfig.doors !== 'none') {
                let doorPrice = 0;
                let doorName = '';
                
                switch(currentConfig.doors) {
                    case '1-barn': doorPrice = 800; doorName = '1 Barn Door'; break;
                    case '2-barn': doorPrice = 1600; doorName = '2 Barn Doors'; break;
                    case '3-barn': doorPrice = 2400; doorName = '3 Barn Doors'; break;
                    case '1-cavity': doorPrice = 600; doorName = '1 Cavity Slider'; break;
                    case '2-cavity': doorPrice = 1200; doorName = '2 Cavity Sliders'; break;
                    case '3-cavity': doorPrice = 1800; doorName = '3 Cavity Sliders'; break;
                }
                
                if (doorPrice > 0) {
                    total += doorPrice;
                    breakdown.push({ name: doorName, price: doorPrice });
                }
            }
            
            const deliveryPrices = {
                'tauranga': 0, 'bop': 500, 'waikato': 800,
                'auckland': 1200, 'wellington': 2000, 'christchurch': 2500, 'other': 1500
            };
            
            const deliveryPrice = deliveryPrices[currentConfig.delivery];
            if (deliveryPrice > 0) {
                total += deliveryPrice;
                breakdown.push({ name: 'Delivery', price: deliveryPrice });
            }
            
            document.getElementById('totalPrice').textContent = '$' + total.toLocaleString();
            
            const breakdownDiv = document.getElementById('priceBreakdown');
            breakdownDiv.innerHTML = '';
            
            breakdown.forEach(function(item) {
                const div = document.createElement('div');
                div.className = 'price-item';
                div.innerHTML = '<span>' + item.name + '</span><span>$' + item.price.toLocaleString() + '</span>';
                breakdownDiv.appendChild(div);
            });
            
            const totalDiv = document.createElement('div');
            totalDiv.className = 'price-item';
            totalDiv.innerHTML = '<span>Total (inc GST)</span><span>$' + total.toLocaleString() + '</span>';
            breakdownDiv.appendChild(totalDiv);
        }

        // Request quote
        function requestQuote() {
            if (!currentConfig.model) {
                alert('Please select a cabin model before requesting a quote.');
                return;
            }
            
            document.getElementById('statusMessage').style.display = 'none';
            document.getElementById('debugPanel').style.display = 'none';
            
            const modal = document.getElementById('quoteModal');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Close modal
        function closeModal() {
            document.getElementById('quoteModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Close modal when clicking outside
        document.getElementById('quoteModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // 🎯 IMPROVED QUOTE SUBMISSION WITH BETTER ERROR HANDLING
        document.getElementById('quoteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('.btn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Sending Quote...';
            submitBtn.disabled = true;
            
            document.getElementById('statusMessage').style.display = 'none';
            document.getElementById('debugPanel').style.display = 'none';
            
            // Prepare quote data
            const formData = {
                customerName: document.getElementById('customerName').value,
                customerEmail: document.getElementById('customerEmail').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerAddress: document.getElementById('customerAddress').value,
                additionalNotes: document.getElementById('additionalNotes').value,
                quoteTotal: document.getElementById('totalPrice').textContent,
                cabinModel: currentConfig.model ? cabinModels[currentConfig.model].name : '',
                buildCategory: document.getElementById('buildCategory').options[document.getElementById('buildCategory').selectedIndex].text,
                bathroomPackage: currentConfig.bathroom,
                kitchenPackage: currentConfig.kitchen,
                cedarPanels: currentConfig.cedarPanels,
                cupboards: currentConfig.cupboards,
                doorUpgrades: currentConfig.doors,
                deliveryLocation: currentConfig.delivery,
                timestamp: new Date().toISOString()
            };
            
            // Create detailed quote breakdown
            const breakdownItems = document.querySelectorAll('.price-item');
            let breakdownText = 'CABIN QUOTE BREAKDOWN:\n\n';
            breakdownItems.forEach(function(item) {
                breakdownText += item.textContent.replace(/\s+/g, ' ') + '\n';
            });
            breakdownText += '\n--- Generated by Freedom Cabins NZ Configurator ---';
            formData.quoteBreakdown = breakdownText;
            
            console.log('📤 Sending quote:', formData);
            
            // Try multiple endpoints
            let lastError = null;
            let debugInfo = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                attempts: []
            };
            
            for (const endpoint of WIX_API_ENDPOINTS) {
                try {
                    console.log(`🔄 Trying endpoint: ${endpoint}`);
                    
                    const attemptInfo = {
                        endpoint: endpoint,
                        timestamp: new Date().toISOString()
                    };
                    
                    showStatus('⏳ Connecting to server...', 'info');
                    
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    attemptInfo.status = response.status;
                    attemptInfo.statusText = response.statusText;
                    
                    console.log(`📨 Response: ${response.status} ${response.statusText}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    attemptInfo.success = true;
                    attemptInfo.responseData = data;
                    debugInfo.attempts.push(attemptInfo);
                    
                    console.log('✅ Success:', data);
                    
                    if (data.success) {
                        showStatus('✅ Quote sent successfully! We\'ll get back to you within 1 hour.', 'success');
                        showSuccessMessage();
                        
                        setTimeout(() => {
                            closeModal();
                            document.getElementById('quoteForm').reset();
                        }, 2000);
                        
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                        return; // Success! Exit the function
                    } else {
                        throw new Error(data.error || 'Unknown error from server');
                    }
                    
                } catch (error) {
                    console.error(`❌ Endpoint ${endpoint} failed:`, error);
                    
                    const attemptInfo = {
                        endpoint: endpoint,
                        timestamp: new Date().toISOString(),
                        success: false,
                        error: error.message
                    };
                    debugInfo.attempts.push(attemptInfo);
                    
                    lastError = error;
                    continue; // Try next endpoint
                }
            }
            
            // All endpoints failed
            console.error('❌ All endpoints failed. Last error:', lastError);
            
            let errorMessage = '❌ Unable to send quote: ';
            
            if (lastError.message.includes('Failed to fetch')) {
                errorMessage += 'Connection failed. Please check your internet connection.';
            } else if (lastError.message.includes('404')) {
                errorMessage += 'Server endpoint not found.';
            } else if (lastError.message.includes('CORS')) {
                errorMessage += 'Cross-origin request blocked.';
            } else {
                errorMessage += lastError.message;
            }
            
            errorMessage += ' Please try the email backup option below.';
            
            showStatus(errorMessage, 'error');
            showDebugInfo(debugInfo);
            
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        });

        // Success message animation
        function showSuccessMessage() {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #da8a67;
                color: white;
                padding: 20px 25px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(218, 138, 103, 0.3);
                z-index: 10001;
                font-weight: 600;
                max-width: 350px;
                animation: slideIn 0.3s ease-out;
            `;
            successDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5rem;">✅</span>
                    <div>
                        <div style="font-size: 1.1rem;">Quote Sent Successfully!</div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">We'll contact you within 1 hour</div>
                    </div>
                </div>
            `;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        // Email backup function
        function openEmailBackup() {
            const customerName = document.getElementById('customerName').value;
            const customerEmail = document.getElementById('customerEmail').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const customerAddress = document.getElementById('customerAddress').value;
            const additionalNotes = document.getElementById('additionalNotes').value;
            const quoteTotal = document.getElementById('totalPrice').textContent;
            const cabinModel = currentConfig.model ? cabinModels[currentConfig.model].name : '';
            const buildCategory = document.getElementById('buildCategory').options[document.getElementById('buildCategory').selectedIndex].text;
            
            const breakdownItems = document.querySelectorAll('.price-item');
            let quoteBreakdown = 'QUOTE BREAKDOWN:\n';
            breakdownItems.forEach(function(item) {
                quoteBreakdown += item.textContent.replace(/\s+/g, ' ') + '\n';
            });
            
            const subject = encodeURIComponent('🏠 New Cabin Quote Request - Freedom Cabins NZ');
            const body = encodeURIComponent(`
New Cabin Quote Request

CUSTOMER DETAILS:
Name: ${customerName}
Email: ${customerEmail}
Phone: ${customerPhone}
Address: ${customerAddress}

${quoteBreakdown}

CONFIGURATION:
Cabin Model: ${cabinModel}
Build Category: ${buildCategory}
Bathroom: ${currentConfig.bathroom}
Kitchen: ${currentConfig.kitchen}
Cedar Panels: ${currentConfig.cedarPanels}
Cupboards: ${currentConfig.cupboards}
Doors: ${currentConfig.doors}
Delivery: ${currentConfig.delivery}

TOTAL: ${quoteTotal}

Additional Notes:
${additionalNotes}

---
Sent via Freedom Cabins NZ Configurator
            `);
            
            const mailtoLink = `mailto:info@freedomcabinsnz.com?subject=${subject}&body=${body}`;
            window.location.href = mailtoLink;
        }

        // Show quote text for copying
        function showQuoteText() {
            const customerName = document.getElementById('customerName').value;
            const customerEmail = document.getElementById('customerEmail').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const customerAddress = document.getElementById('customerAddress').value;
            const additionalNotes = document.getElementById('additionalNotes').value;
            const quoteTotal = document.getElementById('totalPrice').textContent;
            const cabinModel = currentConfig.model ? cabinModels[currentConfig.model].name : '';
            const buildCategory = document.getElementById('buildCategory').options[document.getElementById('buildCategory').selectedIndex].text;
            
            const breakdownItems = document.querySelectorAll('.price-item');
            let quoteBreakdown = 'QUOTE BREAKDOWN:\n';
            breakdownItems.forEach(function(item) {
                quoteBreakdown += item.textContent.replace(/\s+/g, ' ') + '\n';
            });
            
            const quoteText = `🏠 NEW CABIN QUOTE REQUEST - FREEDOM CABINS NZ

CUSTOMER DETAILS:
Name: ${customerName}
Email: ${customerEmail}
Phone: ${customerPhone}
Address: ${customerAddress}

${quoteBreakdown}

CONFIGURATION:
Cabin Model: ${cabinModel}
Build Category: ${buildCategory}
Bathroom: ${currentConfig.bathroom}
Kitchen: ${currentConfig.kitchen}
Cedar Panels: ${currentConfig.cedarPanels}
Cupboards: ${currentConfig.cupboards}
Doors: ${currentConfig.doors}
Delivery: ${currentConfig.delivery}

TOTAL: ${quoteTotal}

Additional Notes:
${additionalNotes}

---
Sent via Freedom Cabins NZ Configurator`;
            
            navigator.clipboard.writeText(quoteText).then(function() {
                showStatus('✅ Quote details copied to clipboard! Please email this to: info@freedomcabinsnz.com', 'success');
            }).catch(function() {
                alert('Please copy this quote and email to info@freedomcabinsnz.com:\n\n' + quoteText);
            });
        }
    </script>
</body>
</html>
